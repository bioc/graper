---
title: "Vignette illustrating the use of grpRR in logisitic regression"
author: "Britta Velten"
date: "`r Sys.Date()`"
output:
  BiocStyle::html_document:
    toc: true
vignette: >
  %\VignetteIndexEntry{Example_scMT}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, message=FALSE, warning=FALSE}
library(grpRR)
library(ggplot2)
```

Note that the implementation of logistic regression is still experimental in some parts.

# Make example data with four groups
Create an example data set with 4 groups, 400 samples and 800 features.
```{r}
set.seed(1234)
data <- makeExampleData(n = 100, p=320, g=4, pis=c(0.05,0.1,0.05,0.1),
                        gammas=c(0.1,0.1,10,10), response = "bernoulli")
```

# Fit the model
`fit_grpRR` is the main function of this package, which allows to fit the proposed Bayesian models with different settings on the prior (by setting `spikeslab` to FALSE or TRUE) and the variational approximation (by setting `factoriseQ` to FALSE or TRUE). By default, the model is fit with a sparsity promoting spike-and-slab prior and a fully-factorised mean-field assumption. The ELBO is currently not calculated in the logisitc regession framework.
```{r}
fit <- grpRR(data$X, data$y, data$annot, verbose = FALSE,
             family = "binomial", calcELB=FALSE)
fit
```

# Posterior distribtions
The variational Bayes (VB) approach directly yields posterior distributions for each parameter. Note, however, that using VB these are often too concentrated and can not be directly used for construciton of confidence intervals etc. However, they can provide good point estimates.
```{r}
plotPosterior(fit, "gamma", gamma0 = data$gammas)
plotPosterior(fit, "pi", pi0 = data$pis)
```

# Model coefficients and intercept
The estimated coefficients and intercept are contained in the result list.
```{r}
# get coefficients (without the intercept)
beta <- coef(fit, include_intercept = FALSE)
# beta <- fit$EW_beta

# plot estimated versus true beta
qplot(beta, data$beta)
```

```{r}
# get intercept
intercept <- fit$intercept
```

```{r}
# get estimated posterior inclusion probabilities per feature
pips <- getPIPs(fit)
```

# Make predictions
The function `fit.grpRR` can be used to make prediction on new data.
Here, we illustrate its use by predicting the reponse using the test data itself.
```{r}
preds <- predict(fit, data$X)
```


#SessionInfo
```{r}
sessionInfo()
```

